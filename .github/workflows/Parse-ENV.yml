name: Parse-ENV

on:
  push:
  workflow_dispatch:
    inputs:
      ssh_host:
        description: "SSH Host"
        required: false
        default: ""
      ssh_user:
        description: "SSH User"
        required: false
        default: ""
      ssh_port:
        description: "SSH Port"
        required: false
        default: ""
      ssh_hostkey:
        description: "SSH Hostkey"
        required: false
        default: ""
      ssh_hostkey:
        description: "SSH Hostkey"
        required: false
        default: ""
      runner:
        description: "Select runner"
        required: true
        default: "windows-latest"
        type: choice
        options:
          - "svr2019-pg"
          - "svr2019-pg-actions-labs-01"
          - "svr2019-pg-actions-labs-02"
          - "windows-2022"
          - "windows-2019"
          - "ubuntu-latest"
          - "ubuntu-22.04"
          - "ubuntu-20.04"

jobs:
  Parse-ENV:
    name: Parse-ENV ${{ inputs.runner != '' && inputs.runner || 'windows-latest' }}
    runs-on: ${{ inputs.runner != '' && inputs.runner || 'windows-latest' }}
    env:
      toJSON_github: ${{ toJSON(github) }}
      toJSON_secrets: ${{ toJSON(secrets) }}
      toJSON_inputs: ${{ toJSON(github.event.inputs) }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # For Windows runners (using PowerShell)
      - name: Set environment variables using PowerShell (Windows)
        if: startsWith(runner.os, 'Windows')
        shell: powershell
        run: |
          ./scripts-yml/parse-env.ps1

      # For Linux runners (using pwsh)
      - name: Set environment variables using PowerShell (Linux)
        if: runner.os == 'Linux'
        shell: pwsh
        run: |
          ./scripts-yml/parse-env.ps1
